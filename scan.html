<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Symphony Gate</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

</head>

<body class="bg-black text-white min-h-screen place-items-center">
    
    
    <div class="w-full max-w-md px-4 text-center space-y-6">
        <br>
        <h1 class="text-2xl font-bold text-yellow-400">
            ðŸŽ¶ Symphony Entry ðŸŽ¶
        </h1>
        <br>
        <div class="w-full bg-indigo-600 hover:bg-indigo-700 p-4 rounded-xl font-semibold text-lg" id="barcode-rtuui">Launch Scanner</div>
        <br>
        <!-- RESULT -->
        <div id="result" class="hidden rounded-xl p-6 text-center space-y-2">
            <p id="resultToken" class="text-lg"></p>
            <p id="stat" class="text-xl font-bold"></p>
        </div>
    </div>



</body>

<div id="document-scanner-container" style="
    display: none;
    width: 100%;
    height: 100vh;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 9999;
    background-color: rgba(0, 0, 0, 0.8);
"></div>

<script type="module">
    import "https://cdn.jsdelivr.net/npm/scanbot-web-sdk@8.0.1/bundle/ScanbotSDK.ui2.min.js";

    const LICENSE_KEY =
        "O1oW6k6iHGrlKlgOt6DklijPituS9c" +
        "qIrVGzy/TmVWeSqs8pgXuhZnfUE5AW" +
        "paqIo//k455gqsFCIQj6TBFwr84Qa+" +
        "3aBCiB9VtjbPdTjxeknaLxXobB/PvN" +
        "KchNbLoq1UfbhCJP9/kMy2mAEl0VAF" +
        "wrVoEVXlzlW+8A9SWZYbsGAPzYvbzb" +
        "QnAIIhyCTBNRpU/l1FnvKUn19D/hmW" +
        "osLjBJ1+rgDY4Xbm2asibZJmzd7yOI" +
        "e9mJY0MCu9+46L5VWkVLFdcsHdrubL" +
        "GMnmtBfTvHCHvhOBPPTWH0ybCXE22B" +
        "k23iG/iVtwpjxm6Te7lLtERHk420tJ" +
        "1Pdjvmbo9pvQ==\nU2NhbmJvdFNESw" +
        "psb2NhbGhvc3R8ZGViYmllYXVnLmdp" +
        "dGh1Yi5pbwoxNzcwMjQ5NTk5CjgzOD" +
        "g2MDcKOA==\n";

    const cdn = "https://cdn.jsdelivr.net/npm/scanbot-web-sdk@8.0.1/bundle/bin/complete/";
    const sdk = await ScanbotSDK.initialize({ enginePath: cdn, licenseKey: LICENSE_KEY });
    const API_URL = "https://script.google.com/macros/s/AKfycbyK5cygiXq6DSHOa06UXSa6a1UxaDqEIMyOuJgcoYL2qmk1z2-LlO_TnV4Qs-9GhRx3/exec";

    document.getElementById("barcode-rtuui").onclick = async () => {

        const box = document.getElementById("result");
        box.classList.add("hidden");

        const config = new ScanbotSDK.UI.Config.BarcodeScannerScreenConfiguration();
        const result = await ScanbotSDK.UI.createBarcodeScanner(config);
        let token = "";

        result.items.forEach((item, index) => {
            const barcode = item.barcode;
            token += barcode.text;
        });
        verifyToken(token);
        toast(`Code: ${token}`);
    };

    function toast(text) {
        Toastify({
            text: text,
            duration: 5000,
            newWindow: true,
            gravity: "bottom",
            position: "center",
            style: {
                background: "linear-gradient(to right, #00b09b, #96c93d)",
                wordWrap: "break-word",
                maxHeight: "200px",
                overflowY: "hidden",
            },
        }).showToast();
    }

    /* ---------- VERIFY TOKEN ---------- */
    async function verifyToken(token) {
        try {
            const res = await fetch(API_URL, {
            method: "POST",
            body: JSON.stringify({
                action: "VERIFY",
                token: token
            })
            });

            const data = await res.json();
            let tk = `Token: ${data.token}`;

            const box = document.getElementById("result");
            const tokenNo = document.getElementById("resultToken");
            const stat = document.getElementById("stat");
            box.classList.remove("hidden");

            if (!data.success) {
                box.className = "rounded-xl p-6 bg-red-700";
                tokenNo.innerText = tk;
                stat.innerText = "INVALID";
            } else {
                if (data.entryStatus === "ENTERED") {
                    box.className = "rounded-xl p-6 bg-red-700";
                    tokenNo.innerText = tk;
                    stat.innerText = "ALREADY ENTERED";
                } else {
                    if (data.status === "CONFIRMED") {
                        box.className = "rounded-xl p-6 bg-green-700";
                        tokenNo.innerText = tk;
                        stat.innerText = "ENTRY ALLOWED";
                    } else {
                        box.className = "rounded-xl p-6 bg-yellow-500 text-black";
                        tokenNo.innerText = tk;
                        stat.innerText = "PAYMENT PENDING";
                    }
                }
            }
        } catch (err) {
            toast("Network Error");
        }
        
    }

    
</script>

<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

</html>



