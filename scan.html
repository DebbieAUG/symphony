<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Live QR Scanner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* This ensures the video fills the container without distortion */
        #video-container { width: 100%; height: 300px; position: relative; overflow: hidden; border-radius: 1rem; background: #000; }
        video { width: 100%; height: 100%; object-fit: cover; }
        .scan-overlay { position: absolute; inset: 0; border: 2px solid rgba(255,255,255,0.3); pointer-events: none; }
        .scan-line { position: absolute; width: 100%; height: 2px; background: #ef4444; top: 0; animation: move 2s infinite linear; }
        @keyframes move { 0% { top: 0; } 100% { top: 100%; } }
    </style>
</head>
<body class="bg-gray-900 min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden">
        <div class="bg-gray-800 p-4 text-center">
            <h1 class="text-white font-bold">LIVE TEXT DECODER</h1>
        </div>

        <div class="p-4">
            <div id="video-container">
                <video id="qr-video"></video>
                <div class="scan-overlay">
                    <div class="scan-line"></div>
                </div>
            </div>
        </div>

        <div class="p-6 space-y-4">
            <div>
                <label class="text-xs font-black text-gray-400 uppercase">Decoded Result</label>
                <textarea id="cam-qr-result" rows="4" readonly 
                    class="w-full mt-1 p-3 bg-gray-100 border-none rounded-xl text-gray-800 text-sm focus:ring-0 resize-none"
                    placeholder="Aim at a QR code..."></textarea>
            </div>
            
            <div class="flex gap-2">
                <button id="copy-btn" class="flex-1 py-3 bg-indigo-600 text-white rounded-xl font-bold active:scale-95 transition-all">Copy</button>
                <button id="clear-btn" class="px-6 py-3 bg-gray-200 text-gray-600 rounded-xl font-bold">Clear</button>
            </div>
        </div>
    </div>

    <script type="module">
        import QrScanner from 'https://bundle.run/qr-scanner@1.4.2';

        const video = document.getElementById('qr-video');
        const resultElement = document.getElementById('cam-qr-result');

        function setResult(result) {
            console.log(result.data);
            resultElement.value = result.data;
            // Visual feedback
            resultElement.classList.add('bg-green-100');
            setTimeout(() => resultElement.classList.remove('bg-green-100'), 300);
        }

        // Initialize Scanner with Pro settings
        const scanner = new QrScanner(video, result => setResult(result), {
            onDecodeError: error => { /* Silent to avoid console spam */ },
            highlightScanRegion: true,
            highlightCodeOutline: true,
            // This is key for high-density codes:
            maxScansPerSecond: 25 
        });

        scanner.start().catch(err => {
            resultElement.value = "Camera Error: " + err;
        });

        // UI Controls
        document.getElementById('copy-btn').onclick = () => {
            navigator.clipboard.writeText(resultElement.value);
            alert('Copied!');
        };
        document.getElementById('clear-btn').onclick = () => resultElement.value = '';
    </script>
</body>
</html>