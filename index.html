<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Symphony Concert Registration</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- QR Code Library -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
</head>

<body class="bg-black text-white min-h-screen flex items-center justify-center px-4">

  <div class="w-full max-w-md bg-zinc-900 rounded-xl p-6 space-y-5">

    <h1 class="text-2xl font-bold text-center">üé∂ Symphony üé∂</h1>
    <p class="text-center text-zinc-400 text-sm">
      Symphony Registration
    </p>

    <!-- FORM -->
    <div id="formSection" class="space-y-4">

      <input id="name" type="text" placeholder="Jesus called you by name...Tell Us"
        class="w-full p-3 rounded bg-zinc-800 border border-zinc-700" />

      <div>
        <p class="mb-1 text-sm">How many years YOUNG are you?üòè</p>
        <select id="ageGroup"
          class="w-full p-3 rounded bg-zinc-800 border border-zinc-700">
          <option value="">Select</option>
          <option>15-20</option>
          <option>21-25</option>
          <option>26-30</option>
          <option>31-35</option>
          <option>35+</option>
        </select>
      </div>

      <div>
        <p class="mb-1 text-sm">Your Spiritual Family!ü´Ç</p>
        <!-- LOCATION DROPDOWN -->
        <div class="relative">
          <p class="mb-1 text-sm text-zinc-400">Location / Church</p>

          <button
            type="button"
            id="locationButton"
            onclick="toggleLocationDropdown()"
            class="w-full px-3 py-2 rounded bg-zinc-800 border border-zinc-700 text-sm text-left flex justify-between items-center"
          >
            <span id="locationSelected" class="text-zinc-400">
              Select
            </span>
            <span class="text-zinc-500">‚ñæ</span>
          </button>

          <ul
            id="locationDropdown"
            class="hidden absolute z-20 mt-1 w-full max-h-56 overflow-y-auto bg-zinc-900 border border-zinc-700 rounded text-xs"
          >

            <!-- OPTIONS -->
            <li onclick="selectLocation(`ABC Father's House - Ps. Raymond`)" class="dropdown-item">ABC Father's House - Ps. Raymond</li>
            <li onclick="selectLocation(`All Nations House Of Prayer - Ps. AP John`)" class="dropdown-item">All Nations House Of Prayer - Ps. AP John</li>
            <li onclick="selectLocation(`ANDF - All Nations Disciple Fellowship - Ps. Neeraj Malik`)" class="dropdown-item">ANDF - All Nations Disciple Fellowship - Ps. Neeraj Malik</li>
            <li onclick="selectLocation(`B.B.C.I. - Ps. John M Philip`)" class="dropdown-item">B.B.C.I. - Ps. John M Philip</li>
            <li onclick="selectLocation(`Believers Brethren Church - Ps. Anish`)" class="dropdown-item">Believers Brethren Church - Ps. Anish</li>
            <li onclick="selectLocation(`Besthda Church - Sukanta Mallick`)" class="dropdown-item">Besthda Church - Sukanta Mallick</li>
            <li onclick="selectLocation(`Bethel AG Church - Pr. Sobichen Thomas`)" class="dropdown-item">Bethel AG Church - Pr. Sobichen Thomas</li>
            <li onclick="selectLocation(`Bethel City Church - Ps. John Prakasam`)" class="dropdown-item">Bethel City Church - Ps. John Prakasam</li>
            <li onclick="selectLocation(`Capital City Church - Ps. Ronald`)" class="dropdown-item">Capital City Church - Ps. Ronald</li>
            <li onclick="selectLocation(`Christ Commision For All Nations - Ps. Philip Rana`)" class="dropdown-item">Christ Commision For All Nations - Ps. Philip Rana</li>
            <li onclick="selectLocation(`Christ Methodist Church, NPV`)" class="dropdown-item">Christ Methodist Church, NPV</li>
            <li onclick="selectLocation(`Church Of Divine Care`)" class="dropdown-item">Church Of Divine Care</li>
            <li onclick="selectLocation(`Church of Epiphany (Civil Line) - Rev. Prateek Pillai`)" class="dropdown-item">Church of Epiphany (Civil Line) - Rev. Prateek Pillai</li>
            <li onclick="selectLocation(`CLG - Church Of Living God - Ps. Shaji Ram`)" class="dropdown-item">CLG - Church Of Living God - Ps. Shaji Ram</li>
            <li onclick="selectLocation(`Come Near To God - Ps. Anand`)" class="dropdown-item">Come Near To God - Ps. Anand</li>
            <li onclick="selectLocation(`DBF Central Gurgaon - Ps. Manovah`)" class="dropdown-item">DBF Central Gurgaon - Ps. Manovah</li>
            <li onclick="selectLocation(`DBF Gurgaon - Ps. Arvind Balaram`)" class="dropdown-item">DBF Gurgaon - Ps. Arvind Balaram</li>
            <li onclick="selectLocation(`DBF Vatika City New Gurgaon - Bro. Victor Selvakumar`)" class="dropdown-item">DBF Vatika City New Gurgaon - Bro. Victor Selvakumar</li>
            <li onclick="selectLocation(`Disciple Community Friends Church - Ps. Stephen Rai`)" class="dropdown-item">Disciple Community Friends Church - Ps. Stephen Rai</li>
            <li onclick="selectLocation(`Divya Shanti AG Prayer Centre - Rev. Paul Narasimha`)" class="dropdown-item">Divya Shanti AG Prayer Centre - Rev. Paul Narasimha</li>
            <li onclick="selectLocation(`Ebenezer Worship Centre - Ps. B. Kunjumon`)" class="dropdown-item">Ebenezer Worship Centre - Ps. B. Kunjumon</li>
            <li onclick="selectLocation(`ECI Telugu Church - Rev. Samuel`)" class="dropdown-item">ECI Telugu Church - Rev. Samuel</li>
            <li onclick="selectLocation(`Emmanuel Baptist - Ps. Bijoy`)" class="dropdown-item">Emmanuel Baptist - Ps. Bijoy</li>
            <li onclick="selectLocation(`Global Christian Life Centre - Rev. Youtha / Rev. Robert`)" class="dropdown-item">Global Christian Life Centre - Rev. Youtha / Rev. Robert</li>
            <li onclick="selectLocation(`God's Creation - Ps. Ravinder`)" class="dropdown-item">God's Creation - Ps. Ravinder</li>
            <li onclick="selectLocation(`Gurgaon Bible Church`)" class="dropdown-item">Gurgaon Bible Church</li>
            <li onclick="selectLocation(`Gurgaon Christian Fellowship - Ps. David Dayalan`)" class="dropdown-item">Gurgaon Christian Fellowship - Ps. David Dayalan</li>
            <li onclick="selectLocation(`Haryana Berean Fellowship - Ps. Balinder Mehra`)" class="dropdown-item">Haryana Berean Fellowship - Ps. Balinder Mehra</li>
            <li onclick="selectLocation(`House Of Hope - Ps. Jijo Varghese`)" class="dropdown-item">House Of Hope - Ps. Jijo Varghese</li>
            <li onclick="selectLocation(`Indian Church Of Christ`)" class="dropdown-item">Indian Church Of Christ</li>
            <li onclick="selectLocation(`Indian Pentecostal Assembly - Ps. Blesson`)" class="dropdown-item">Indian Pentecostal Assembly - Ps. Blesson</li>
            <li onclick="selectLocation(`IPC Good Shepherd - Ps. David Samuel`)" class="dropdown-item">IPC Good Shepherd - Ps. David Samuel</li>
            <li onclick="selectLocation(`Ivan - Ivan Oscar Adan Fernandez`)" class="dropdown-item">Ivan - Ivan Oscar Adan Fernandez</li>
            <li onclick="selectLocation(`Jeevan Jyoti - Ps. Samuel Cyrus / Rev. Bharat`)" class="dropdown-item">Jeevan Jyoti - Ps. Samuel Cyrus / Rev. Bharat</li>
            <li onclick="selectLocation(`Life Hinglish Church - Ps. Gladwin`)" class="dropdown-item">Life Hinglish Church - Ps. Gladwin</li>
            <li onclick="selectLocation(`Mahaneh Dan Fellowship - Ps. Anil Baby`)" class="dropdown-item">Mahaneh Dan Fellowship - Ps. Anil Baby</li>
            <li onclick="selectLocation(`Maranatha House Fellowship - Ps. Vikas Balguher`)" class="dropdown-item">Maranatha House Fellowship - Ps. Vikas Balguher</li>
            <li onclick="selectLocation(`Masih Prarthana Bhawan`)" class="dropdown-item">Masih Prarthana Bhawan</li>
            <li onclick="selectLocation(`Menorah Christian Fellowship - Ps. Prakash PS`)" class="dropdown-item">Menorah Christian Fellowship - Ps. Prakash PS</li>
            <li onclick="selectLocation(`New Hope Fellowship`)" class="dropdown-item">New Hope Fellowship</li>
            <li onclick="selectLocation(`New Life Church - Ps. Victor Nazareth`)" class="dropdown-item">New Life Church - Ps. Victor Nazareth</li>
            <li onclick="selectLocation(`New Life Revival Centre - Ps. J.B. Suna`)" class="dropdown-item">New Life Revival Centre - Ps. J.B. Suna</li>
            <li onclick="selectLocation(`New Testament Church - Ps. Iqbal Masih`)" class="dropdown-item">New Testament Church - Ps. Iqbal Masih</li>
            <li onclick="selectLocation(`Penial House of Fellowship - Ps. Ankush`)" class="dropdown-item">Penial House of Fellowship - Ps. Ankush</li>
            <li onclick="selectLocation(`Precept Ministries, House Of Prayers`)" class="dropdown-item">Precept Ministries, House Of Prayers</li>
            <li onclick="selectLocation(`Recreate Prayer House - Ps. Mukesh Kumar`)" class="dropdown-item">Recreate Prayer House - Ps. Mukesh Kumar</li>
            <li onclick="selectLocation(`Shalom New Fellowship - Ps. Joy ER`)" class="dropdown-item">Shalom New Fellowship - Ps. Joy ER</li>
            <li onclick="selectLocation(`Shalom New Fellowship Dhankot - Ps. Kishan`)" class="dropdown-item">Shalom New Fellowship Dhankot - Ps. Kishan</li>
            <li onclick="selectLocation(`The Masters Place`)" class="dropdown-item">The Masters Place</li>
            <li onclick="selectLocation(`UHOP AG Church - Ps. Sam Sundar`)" class="dropdown-item">UHOP AG Church - Ps. Sam Sundar</li>
            <li onclick="selectLocation(`Victory Church - Ps. Britto`)" class="dropdown-item">Victory Church - Ps. Britto</li>
            <li onclick="selectLocation(`Yeshu Naam Satsang - Ps. Sonu`)" class="dropdown-item">Yeshu Naam Satsang - Ps. Sonu</li>
            <li onclick="selectLocation(`Yeshu Prem Mandir`)" class="dropdown-item">Yeshu Prem Mandir</li>
            <li onclick="selectLocation(`Yeshu Satsang - Ps. Vipin Mathew`)" class="dropdown-item">Yeshu Satsang - Ps. Vipin Mathew</li>
            <li onclick="selectLocation(`Zion Global Worship Centre - Ps. Moncy`)" class="dropdown-item">Zion Global Worship Centre - Ps. Moncy</li>

            <li onclick="selectLocation('Other')" class="dropdown-item font-semibold">Other</li>
          </ul>
        </div>

        <!-- Hidden input for validation & submit -->
        <input type="hidden" id="location" />
        <style>
          .dropdown-item {
            padding: 0.5rem 0.75rem;
            cursor: pointer;
          }
          .dropdown-item:hover {
            background-color: #27272a;
          }
        </style>
      </div>

      <input id="otherLocation" type="text"
        placeholder="Please specify Church with Pastor's Name"
        class="hidden w-full p-3 rounded bg-zinc-800 border border-zinc-700" />

      <div>
        <p class="mb-1 text-sm">Registration Fee: Rs. 50/-</p>
        <!-- PAYMENT QR IMAGE -->
        <div class="text-center space-y-2">
            <p class="text-sm text-zinc-400">
                Scan to pay
            </p>
            <img
                src="payment-qr.png"
                alt="UPI QR"
                class="mx-auto w-40 rounded-lg border border-zinc-700"
            />
            <p class="text-xs text-zinc-500 text-center"> UPI: doratharajoy@okhdfcbank </p>
        </div>

        <select id="paymentDone"
          class="w-full p-3 rounded bg-zinc-800 border border-zinc-700"
          onchange="toggleUPI()">
          <option value="">Select</option>
          <option>Yes, Paid!üëç</option>
          <option>Will pay in cash.ü´∞</option>
        </select>
      </div>

      <input id="upiRefId" type="text"
        placeholder="UPI Reference ID / CASH"
        class="hidden w-full p-3 rounded bg-zinc-800 border border-zinc-700" />

      <button onclick="generateToken()"
        class="w-full bg-indigo-600 hover:bg-indigo-700 p-3 rounded font-semibold">
        Generate Token
      </button>
    </div>

    <!-- TOKEN PREVIEW -->
    <div id="tokenPreview" class="hidden text-center space-y-3">
      <p class="text-sm text-zinc-400">Your Token (Preview)</p>
      <p id="tokenText" class="text-xl font-bold"></p>

      <!-- <button onclick="submitForm()"
        class="w-full bg-green-600 hover:bg-green-700 p-3 rounded font-semibold">
        Confirm Registration
      </button> -->

      <button
        id="submitBtn"
        onclick="submitForm()"
        class="w-full bg-green-600 hover:bg-green-700 p-3 rounded font-semibold">
        Confirm Registration
      </button>


    </div>

    <!-- SUCCESS -->
    <div id="successSection" class="hidden text-center space-y-4">

      <p class="text-green-400 font-semibold text-lg">
        Registration Confirmed
      </p>

      <!-- Instagram Follow Card -->
      <div class="bg-zinc-800 border border-zinc-700 rounded-lg p-4 mx-auto">
        <p class="text-sm text-zinc-300">
          For updates & announcements, follow us on Instagram
          <a
            href="https://www.instagram.com/gurgaonyuvamovement"
            target="_blank"
            rel="noopener noreferrer"
            class="font-semibold text-pink-400 hover:text-pink-300 ml-1"
          >
            @gurgaonyuvamovement
          </a>
        </p>
      </div>

      <p id="finalToken" class="text-2xl font-bold tracking-wider">
      </p>

      <!-- QR CODE -->
      <div id="qrCode" class="flex justify-center my-2"></div>

      <p class="text-xs text-zinc-400">
        Screenshot your token & QR for entry
      </p>

    </div>


  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyK5cygiXq6DSHOa06UXSa6a1UxaDqEIMyOuJgcoYL2qmk1z2-LlO_TnV4Qs-9GhRx3/exec";
let previewToken = "";

function toggleOtherLocation() {
  document.getElementById("otherLocation").classList.toggle(
    "hidden",
    document.getElementById("location").value !== "Other"
  );
}

function toggleUPI() {
  document.getElementById("upiRefId").classList.toggle(
    "hidden",
    document.getElementById("paymentDone").value !== "Yes, Paid!üëç"
  );
}

function generateToken() {
  previewToken = "GYM-SYM-CODE";
  document.getElementById("tokenText").innerText = previewToken;
  document.getElementById("formSection").classList.add("hidden");
  document.getElementById("tokenPreview").classList.remove("hidden");
}

function toggleLocationDropdown() {
  document.getElementById("locationDropdown").classList.toggle("hidden");
}

function selectLocation(value) {
  document.getElementById("location").value = value;
  const label = document.getElementById("locationSelected");
  label.innerText = value;
  label.classList.remove("text-zinc-400");
  label.classList.add("text-white");

  document.getElementById("locationDropdown").classList.add("hidden");

  const otherField = document.getElementById("otherLocation");
  if (value === "Other") {
    otherField.classList.remove("hidden");
  } else {
    otherField.classList.add("hidden");
    otherField.value = "";
  }
}

// Close when clicking outside
document.addEventListener("click", function (e) {
  const btn = document.getElementById("locationButton");
  const list = document.getElementById("locationDropdown");
  if (!btn.contains(e.target) && !list.contains(e.target)) {
    list.classList.add("hidden");
  }
});

async function submitForm() {
  const submitBtn = document.getElementById("submitBtn");

  // Disable immediately
  submitBtn.disabled = true;
  submitBtn.innerText = "Confirming...";
  submitBtn.classList.add("opacity-50", "cursor-not-allowed");

  const payload = {
    name: document.getElementById("name").value,
    ageGroup: document.getElementById("ageGroup").value,
    location: document.getElementById("location").value,
    otherLocation: document.getElementById("otherLocation").value,
    paymentDone: document.getElementById("paymentDone").value,
    upiRefId: document.getElementById("upiRefId").value
  };

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (data.success) {
      document.getElementById("tokenPreview").classList.add("hidden");
      document.getElementById("successSection").classList.remove("hidden");
      document.getElementById("finalToken").innerText = data.token;

      // Clear any old QR
      const qrContainer = document.getElementById("qrCode");
      qrContainer.innerHTML = "";

      // Generate QR
      new QRCode(qrContainer, {
        text: data.token,
        width: 180,
        height: 180
      });

    } else {
      alert(data.error);
      restoreSubmitButton(submitBtn);
    }

  } catch (err) {
    alert("Network error. Please try again.");
    restoreSubmitButton(submitBtn);
  }
}

function restoreSubmitButton(btn) {
  btn.disabled = false;
  btn.innerText = "Confirm Registration";
  btn.classList.remove("opacity-50", "cursor-not-allowed");
}


</script>

</body>
</html>